cache: &global_cache
  key: ${CI_COMMIT_REF_SLUG}
  paths:
    - apt-cache/
    - node_modules/
  policy: pull-push

stages:
  - lint
  - coverage
  - dependency
  - test
  - publish

default:
  image: node:16
  before_script:
    - echo "Validate, build and deploy sequelize-factory"
    - node --version
    - yarn install

"Lint":
  stage: lint
  script:
    - yarn lint

"Coverage":
  stage: coverage
  script:
    - echo "Coverage"

"Dependency":
  stage: dependency
  script:
    - echo "Dependency"

"Test":
  stage: test
  script:
    - echo "Test"

"Publish":
  stage: publish
  script:
    - echo "Publish"
    - apt-get update && apt-get install -y --no-install-recommends git-core ca-certificates
    - npm install -g semantic-release @semantic-release/gitlab @semantic-release/npm @semantic-release/git
    - echo $NPM_AUTH_TOKEN > .npmrc
    - semantic-release
  only:
    - master
